<ng-container>
    <div class="theme-container single-content" *ngIf="content$ | async as c; else loading">
        <div class="title-section">
            <div class="d-flex align-items-center">
                <div class="flex-even">
                    <h1 class="page-title" [title]="c.title">{{ c.title | substring:40 }}</h1>
                </div>
            </div>
            <hr class="my-4">
        </div>
    
        <div class="row mb-4" *ngIf="content$ | async as c">
            <div class="col-lg-6">
                <div class="d-flex align-items-center content-wrapper">
                    <ng-container *ngIf="c.fileType | isvideo">
                        <video autoplay muted [src]="c.url+c.fileName"></video>
                    </ng-container>
                    <ng-container *ngIf="c.fileType | isimage">
                        <img [src]="c.url+c.fileName">
                    </ng-container>
                    <ng-container *ngIf="c.fileType == 'feed'">
                        <img [src]="fs_screenshot + '/' + c.url | sanitize">
                    </ng-container>
                </div>
            </div>
            <div class="col-lg-6">
                <mat-card class="p-4">
                    <h5 class="mb-0 font-weight-medium">
                        Content Information
                    </h5>
    
                    <hr>
    
                    <div class="d-flex">
                        <div class="flex-even filename">
                            <span class="sm-text">
                                Filename
                            </span>
                            <h5 class="mb-0" [title]="c.title">
                                {{ c.title | substring:32 }}
                            </h5>
                        </div>
    
                        <div class="flex-even filetype">
                            <span class="sm-text">
                                Filetype
                            </span>
                            <h5 class="mb-0">
                                {{ c.fileType }}
                            </h5>
                        </div>
                    </div>
                    
                    <hr class="my-3">
    
                    <div class="d-flex">
                        <div class="flex-even uploaded-by">
                            <span class="sm-text">
                                Uploaded by
                            </span>
                            <h5>
                                {{ c.createdByName || 'N/A' }}
                            </h5>
                        </div>
    
                        <div class="flex-even date-uploaded">
                            <span class="sm-text">
                                Date Uploaded
                            </span>
                            <h5>
                                {{ c.dateCreated | date }}
                            </h5>
                        </div>

                        <div class="flex-even duration" *ngIf="c.fileType == 'webm'">
                            <span class="sm-text">
                                Duration
                            </span>
                            <h5>
                                {{ c.duration }}
                            </h5>
                        </div>
                    </div>
                    
                    <hr class="my-3">

                    <div class="d-flex">
                        <div class="flex-even uploaded-by">
                            <span class="sm-text">
                                License Count
                            </span>
                            <h5>
                                {{ license_count }}
                            </h5>
                        </div>
    
                        <div class="flex-even date-uploaded">
                            <span class="sm-text">
                                Host Count
                            </span>
                            <h5>
                                {{ host_count }}
                            </h5>
                        </div>


                        <div class="flex-even duration">
                            <span class="sm-text">
                                Playlist Count
                            </span>
                            <h5>
                                {{ in_playlist.length }}
                            </h5>
                        </div>

                        <div class="flex-even duration">
                            <span class="sm-text">
                                Screen Count
                            </span>
                            <h5>
                                {{ screen_count }}
                            </h5>
                        </div>
                    </div>
                </mat-card>
            </div>
        </div>
    
        <div class="row">
            <div class="col-lg-12 custom-mat-tab">
                <mat-tab-group dynamicHeight>
                    <!-- <mat-tab label="Content Analytics">
                        <div class="row align-items-center mt-4">
                            <div class="col-lg-4">
                                <h3 class="mb-0">Report for {{ date_selected }}</h3>
                            </div>
                            <div class="col-lg-8 text-right">
                                <mat-form-field appearance="fill">
                                    <mat-label>Choose a date</mat-label>
                                    <input matInput (dateInput)="onSelectDate($event.value)" [matDatepicker]="contentDatePicker" [(value)]="queried_date" readonly>
                                    <mat-datepicker-toggle matSuffix [for]="contentDatePicker"></mat-datepicker-toggle>
                                    <mat-datepicker #contentDatePicker></mat-datepicker>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12 mb-4">
                                <mat-card>
                                    <ng-container *ngIf="!daily_chart_updating; else loader">
                                        <app-data-graph
                                            [data_set]="content_daily_count"
                                            [graph_title]="'Daily Content Play Analytics'"
                                            [graph_description]="'Graph shows the play count of this content for this day.'"
                                            [graph_id]="'daily_graph'"
                                            [realtime_data_per_content]="realtime_data"
                                            [update_chart]="update_chart">
                                        </app-data-graph>
                                    </ng-container>
                                </mat-card>
                            </div>
    
                            <div class="col-lg-12 mb-4">
                                <mat-card>
                                    <ng-container *ngIf="!monthly_chart_updating; else loader">
                                        <app-data-graph 
                                            [date_format]="'monthly'"
                                            [data_set]="content_monthly_count"
                                            [graph_title]="'Monthly Content Play Analytics'"
                                            [graph_description]="'Graph shows the play count of this content for this month.'"
                                            [graph_id]="'monthly_graph'"
                                            [realtime_data_per_content]="realtime_data"
                                            [update_chart]="update_chart">
                                        </app-data-graph>
                                    </ng-container>
                                </mat-card>
                            </div>
    
                            <div class="col-lg-12">
                                <mat-card>
                                    <ng-container *ngIf="!yearly_chart_updating; else loader">
                                        <app-data-graph 
                                            [date_format]="'yearly'"
                                            [data_set]="content_yearly_count"
                                            [graph_title]="'Yearly Content Play Analytics'"
                                            [graph_description]="'Graph shows the play count of this content for this year.'"
                                            [graph_id]="'yearly_graph'"
                                            [realtime_data_per_content]="realtime_data"
                                            [update_chart]="update_chart">
                                        </app-data-graph>
                                    </ng-container>
                                </mat-card>
                            </div>
                        </div>
                    </mat-tab> -->
                    <mat-tab label="Reports">
                        <div class="row align-items-center mt-4 mb-4">
                            <div class="col-lg-6">
                                <h2 class="m-0">Playlist Reports</h2>
                                <p class="sm-text">Select Start and End Date then click the Generate button to get started.</p>
                            </div>
                            <div class="col-lg-6">
                                <div class="d-flex">
                                    <div class="flex-even">
                                        <mat-form-field class="w-100" appearance="fill" appDefaultDateFormat>
                                            <mat-label class="md-text">Start Date</mat-label>
                                            <input (dateInput)="onSelectStartDate($event.value)" [(value)]="start_date" matInput [matDatepicker]="datePicker" readonly>
                                            <mat-datepicker-toggle matSuffix [for]="datePicker"></mat-datepicker-toggle>
                                            <mat-datepicker #datePicker></mat-datepicker>
                                        </mat-form-field>
                                    </div>
                
                                    <div class="flex-even mx-3">
                                        <mat-form-field class="w-100" appearance="fill" appDefaultDateFormat>
                                            <mat-label class="md-text">End Date</mat-label>
                                            <input (dateInput)="onSelectEndDate($event.value)" [(value)]="end_date" matInput [matDatepicker]="datePicker2" [min]="start_date"
                                                readonly>
                                            <mat-datepicker-toggle matSuffix [for]="datePicker2"></mat-datepicker-toggle>
                                            <mat-datepicker #datePicker2></mat-datepicker>
                                        </mat-form-field>
                                    </div>
            
                                    <div>
                                        <button mat-button mat-raised-button class="theme-btn px-4" [disabled]="!start_date || !end_date || generating_report" style="height: 60px;" title="Generate Report" (click)="generateReport()">
                                            <div class="d-flex align-items-center">
                                                <div class="flex-even mr-2">
                                                    <span class="fas fa-chart-bar"></span>
                                                    <span class="ml-2">Generate</span>
                                                </div>
                                                <div *ngIf="generating_report">
                                                    <mat-spinner [diameter]="20"></mat-spinner>
                                                </div>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row" *ngIf="report_generated">
                            <div class="col-lg-12 flex">
                                <div class="col-lg-4 bg-dark px-3 py-2 d-inline-block rounded mr-2">
                                    <h5 class="mb-0 text-white pt-1">
                                        Showing records from <span class="text-primary">{{ start_date | date }}</span> to <span class="text-primary">{{ end_date | date }}</span>
                                    </h5>
                                </div>
                                <div class="col-lg-4 bg-dark px-3 py-2 d-inline-block rounded mr-2">
                                    <h5 class="mb-0 text-white pt-1">
                                       Summary : Total Play Count: <span class="text-primary">{{ total_playcount }}</span> Total Play Duration: <span class="text-primary">{{ total_duration }}</span>
                                    </h5>
                                </div>
                                <div class="col-lg-4">
                                    <button mat-button mat-raised-button
                                        class="float-right theme-btn pi-control sm-text _primary mr-2" 
                                        (click)="exportTable()"
                                        [disabled]="workbook_generation"  
                                        title="Export to CSV">
                                        <span class="{{!workbook_generation ? 'fas fa-file-excel' : 'fas fa-spinner'}}"></span> 
                                        <span class="ml-2 button_text_animation">{{!workbook_generation ? 'Export' : 'Generating CSV'}}</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <mat-card *ngIf="content_logs_report.length > 0; else nodata" class="mt-4">
                            <app-data-table 
                            [table_data]="content_logs_report"
                            [table_columns]="content_logs_report_table_columns"
                            [new_table]="true"></app-data-table>
                        </mat-card>
                    </mat-tab>
                    <mat-tab label="In Playlist">
                        <mat-card *ngIf="in_playlist.length > 0; else nodata" class="mt-4">
                            <app-data-table 
                            [table_data]="in_playlist"
                            [table_columns]="in_playlist_table_columns"
                            [new_table]="true"></app-data-table>
                        </mat-card>
                    </mat-tab>
                    <mat-tab label="Playing Where">
                        <mat-card *ngIf="playing_where.length > 0; else nodata" class="mt-4">
                            <app-data-table 
                            [table_data]="playing_where"
                            [table_columns]="table_columns"
                            [new_table]="true"></app-data-table>
                        </mat-card>
                    </mat-tab>
                    <mat-tab label="History">
                        <mat-card *ngIf="content_history.length > 0; else nodata" class="mt-4">
                            <app-data-table [table_data]="content_history"
                             [table_columns]="content_history_table_columns"
                             [paging_details]="paging_data_history" 
                             (page_triggered)="onClickPageNumber($event)"
                             [new_table]="true">
                            </app-data-table>
                        </mat-card>
                    </mat-tab>
                </mat-tab-group>
            </div>
        </div>
    
        <ng-template #loader>
            <div class="loader text-center py-5">
                <app-spinner></app-spinner>
                <h3 class="mt-4 mb-2">Please Wait</h3>
                <p class="sm-text">Getting content logs from database.</p>
            </div>
        </ng-template>
    
        <ng-template #nodata>
            <div class="col-lg-12 pl-0 pr-0">
                <mat-card class="pt-5 pb-5 col-lg-12 text-center">
                    <div class="mb-4">
                        <i class="text-gray fa-5x far fa-file-alt"></i>
                    </div>
                    <h3 class="text-gray col-lg-12">
                        {{ generating_report ? 'Generating Content Logs Report, Please Wait ...' : 'No Data Found' }}
                    </h3>
                </mat-card>
            </div>
        </ng-template>
    </div>

    <ng-template #loading>
        <div class="loader text-center py-5">
            <app-spinner></app-spinner>
            <h3 class="mt-4 mb-2">Please Wait</h3>
        </div>
    </ng-template>
</ng-container>