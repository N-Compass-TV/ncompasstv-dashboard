<div class="theme-container single-playlis">
	<div class="view">
		<section class="title-section mb-4">
			<div class="d-flex align-items-center">
				<div class="flex-even">
					<h1 class="page-title">{{ playlistName }}</h1>
					<p class="sm-text mb-0">{{ playlistDescription }}</p>
				</div>
			</div>
		</section>

		<section class="playlist-workbench">
			<mat-tab-group>
				<mat-tab label="Content Management">
					<div class="playlist-content-management-wrapper pt-3">
						<section class="playlist-content-management-controls d-flex mb-3">
							<div class="playlist-stats d-flex">
								<div
									class="breakdown-item"
									*ngFor="let p of playlistContentBreakdown; let i = index"
									[ngClass]="i < playlistContentBreakdown.length - 1 && 'mr-4'">
									<h4 class="font-weight-bold m-0 text-green">
										{{ p.total }}
									</h4>
									<p class="xsm-text font-weight-bold font-italic m-0">{{ p.label }}</p>
								</div>
							</div>
							<div class="flex-even text-right">
								<ng-container *ngFor="let c of playlistControls; let i = index">
									<button
										mat-button
										mat-raised-button
										class="theme-btn"
										[ngClass]="i < playlistControls.length - 1 && 'mr-2'"
										[disabled]="c.disabled"
										(click)="playlistControlClicked(c)">
										<i class="{{ c.icon }} mr-3 text-green"></i>
										<small class="font-weight-bold">{{ c.label }}</small>
									</button>
								</ng-container>
							</div>
						</section>

						<section class="bg-white box-shadow p-4 playlist-content-management rounded">
							<div class="filter-controls">
								<div class="d-flex">
									<div class="flex-even">
										<div class="d-flex">
											<!-- Filters -->
											<div class="filters-and-search mr-4">
												<div class="d-flex align-items-center filters-wrapper border rounded px-2">
													<h6 class="floating-title">FILTERS</h6>
													<div class="d-flex">
														<div
															class="content-filters"
															*ngFor="let p of playlistFilters; let i = index"
															[ngClass]="i == 0 && 'mr-3'">
															<button mat-button mat-raised-button class="theme-btn" [matMenuTriggerFor]="menu">
																<i class="{{ p.icon }} mr-3 text-green"></i>
																<small class="font-weight-bold mr-2"
																	>{{ p.label }}

																	<ng-container *ngIf="p.label === 'Content Type' && currentFilters.type">
																		: {{ currentFilters.type | titlecase }}
																	</ng-container>

																	<ng-container *ngIf="p.label === 'Content Status' && currentFilters.status">
																		: {{ currentFilters.status | titlecase }}
																	</ng-container>
																</small>
																<i class="fas fa-caret-down"></i>
															</button>
															<mat-menu #menu="matMenu">
																<button
																	mat-menu-item
																	*ngFor="let i of p.items"
																	(click)="filterContent(p.action, i.action)">
																	{{ i.label }}
																</button>
															</mat-menu>
														</div>
													</div>
												</div>
											</div>

											<!-- View Options -->
											<div class="other-options mr-4">
												<div class="d-flex align-items-center filters-wrapper border rounded px-2">
													<h6 class="floating-title">VIEWS</h6>
													<div class="d-flex">
														<button
															mat-button
															mat-raised-button
															class="theme-btn"
															*ngFor="let p of playlistViews; let i = index"
															(click)="viewButtonClicked(p.action)"
															[ngClass]="i !== playlistViews.length - 1 && 'mr-3'"
															[class.selected]="p.is_selected">
															<i class="{{ p.icon }} mr-3 text-green"></i>
															<small class="font-weight-bold mr-1">{{ p.label }}</small>
														</button>
													</div>
												</div>
											</div>
										</div>
									</div>

									<div class="search-form-wrapper">
										<form class="search-form">
											<mat-form-field class="full-width" appearance="fill">
												<mat-label>Search Playlist Content</mat-label>
												<input matInput placeholder="Example: Pizza Ad" type="text" [formControl]="searchForm" />
											</mat-form-field>
										</form>
									</div>
								</div>
							</div>

							<div class="bg-gray box-shadow p-3 playlist-contents vh-64 rounded overflow-y-scroll">
								<div class="row no-gutters" #draggables id="draggables" *ngIf="!savingPlaylist && playlist as p; else spinner">
									<div
										id="{{ 'drg_' + c.playlistContentId }}"
										[ngClass]="detailedViewMode ? 'col-lg-4' : 'col-lg-1-5'"
										*ngFor="let c of playlistContents"
										[attr.data-id]="c.playlistContentId">
										<div class="m-1">
											<app-content
												[content]="c"
												[detailed_view_mode]="detailedViewMode"
												[index]="c.seq"
												[move_enabled]="sortablejsTriggered"
												[saving]="playlistContentsToSave.includes(c.playlistContentId)"
												[selected]="selectedPlaylistContents.includes(c.playlistContentId)"
												(control_click)="contentControlClicked($event)"
												(content_selected)="playlistContentSelected(c.playlistContentId)">
											</app-content>
										</div>
									</div>
								</div>
							</div>
						</section>
					</div>
				</mat-tab>
				<mat-tab label="Screens">
					<mat-card class="mt-3" *ngIf="playlistScreens && playlistScreens.length">
						<app-data-table [table_columns]="screenTableColumns" [table_data]="playlistScreenTable" [new_table]="true"> </app-data-table>
					</mat-card>
				</mat-tab>
				<mat-tab label="Host & Licenses">
					<button
						mat-button
						mat-raised-button
						class="theme-btn mr-2 mt-3"
						(click)="pushUpdateToSelectedLicenses()"
						[disabled]="licensesToUpdate.length == 0 || is_view_only">
						Push Updates to Selected Licenses
					</button>

					<div class="row no-gutters">
						<div class="col-lg-6">
							<div class="mt-3">
								<ng-container>
									<mat-accordion>
										<mat-expansion-panel hideToggle [expanded]="false" *ngFor="let h of playlistHostLicenses">
											<mat-expansion-panel-header>
												<div class="d-flex w-100">
													<div>
														<a [routerLink]="[host_url, h.host.hostId]" target="_blank">
															<h5 class="sm-text font-weight-bold mb-0">{{ h.host.name }}</h5>
														</a>
													</div>
													<div class="flex-even text-right sm-text">
														{{ h.licenses.length }} License<span *ngIf="h.licenses.length > 1">s</span>
														<span class="fas fa-arrow-down ml-2"></span>
													</div>
												</div>
											</mat-expansion-panel-header>

											<div class="px-3 py-3 border-top w-100">
												<div *ngFor="let l of h.licenses" class="option-license-list w-100 mb-1">
													<mat-checkbox class="sm-text" (change)="addToLicenseToPush($event, l.licenseId)">
														<a [routerLink]="[license_url, l.licenseId]" target="_blank">
															<h5 class="sm-text font-weight-bold mb-0">{{ l.alias || l.licenseKey }}</h5>
														</a>
													</mat-checkbox>
												</div>
											</div>
										</mat-expansion-panel>
									</mat-accordion>
								</ng-container>
							</div>
						</div>
					</div>
				</mat-tab>
			</mat-tab-group>
		</section>
	</div>

	<ng-template #spinner>
		<div class="vh-60">
			<app-spinner [message]="(savingPlaylist && 'Saving playlist, Please wait ...') || 'Getting Playlist, Please wait ...'"></app-spinner>
		</div>
	</ng-template>
</div>
