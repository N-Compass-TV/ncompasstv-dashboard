<div class="p-2" id="addTagModal">
	<div class="d-flex heading">
		<div class="flex-even">
			<h3 class="p-0 col-lg-12">{{ title }}</h3>
			<p class="sm-text mb-4">{{ description }}</p>
		</div>
		<div>
			<button class="modal-close-btn no-border no-background" [mat-dialog-close]="false">
				<span class="fas fa-times"></span>
			</button>
		</div>
	</div>

	<div class="sections-container d-flex flex-column">
		<!-- FORM SECTION -->
		<div class="form-section">
			<form [formGroup]="form" (ngSubmit)="onSubmit()">
				<div class="fields d-flex">
					<div class="add-tag d-flex">
						<div class="create d-flex flex-column">
							<h4>Create new tag:</h4>
							<div class="input-section d-flex flex-column">
								<!-- TAG NAME -->
								<mat-form-field class="tag-name full-width">
									<input matInput type="text" formControlName="name" placeholder="Tag Name" />
								</mat-form-field>

								<!-- TAG DESCRIPTION -->
								<mat-form-field class="tag-description full-width">
									<input matInput type="text" formControlName="description" placeholder="Tag Description" />
								</mat-form-field>

								<!-- TAG COLOR PICKER -->
								<mat-form-field class="tag-color">
									<mat-label>Tag Color</mat-label>
									<input
										matInput
										type="text"
										formControlName="tagColor"
										autocomplete="off"
										[(colorPicker)]="selectedTagColor"
										[cpAlphaChannel]="'disabled'"
										[cpDisableInput]="true"
										[style.background]="selectedTagColor"
										[value]="selectedTagColor || ''"
										(colorPickerChange)="onSelectTagColor(selectedTagColor)" />
								</mat-form-field>

								<!-- IS TAG EXCLUDED? -->
								<mat-slide-toggle
									class="exclude-toggle"
									formControlName="exclude"
									[checked]="form.get('exclude').value"
									[labelPosition]="'before'">
									Exclude tag?
								</mat-slide-toggle>

								<button class="add theme-btn _primary" mat-button mat-raised-button (click)="onAddTag()" [disabled]="cannotAddTag()">
									<ng-container *ngIf="isCheckingTagExistence; else doneChecking">
										<mat-icon>pending</mat-icon>
									</ng-container>
									<ng-template #doneChecking> Add </ng-template>
								</button>
							</div>
						</div>

						<div class="assign d-flex flex-column">
							<h4>Use existing tags:</h4>
							<!-- TAG SELECT SEARCH -->
							<mat-form-field class="full-width existing-tags-select">
								<mat-select #tagMultiSelect formControlName="existing" [placeholder]="'Choose a tag'" [multiple]="true">
									<mat-option>
										<ngx-mat-select-search
											noEntriesFoundLabel="No results"
											formControlName="tagFilter"
											[placeholderLabel]="'Search a tag'"
											[clearSearchInput]="false"
											[searching]="isSearchingTags">
											<mat-icon class="clear" ngxMatSelectSearchClear>close</mat-icon>
										</ngx-mat-select-search>
									</mat-option>

									<mat-option *ngFor="let tag of filteredTags | async" [value]="tag">
										<div class="tag">{{ tag.name }}</div>
									</mat-option>
								</mat-select>
							</mat-form-field>
						</div>
					</div>
				</div>

				<div class="preview d-flex flex-column">
					<!-- NEW TAGS ROW -->
					<div class="tags-row new-tags d-flex">
						<h4>To Create:</h4>

						<!-- NEW TAGS LIST -->
						<div class="tags-container d-flex flex-row align-items-start flex-wrap">
							<div
								class="tag d-flex align-items-center"
								*ngFor="let tag of form.get('new').value; let i = index"
								[style.backgroundColor]="tag.tagColor">
								<div class="name" matTooltip="{{ tag.description }}">{{ tag.name }}</div>
								<ng-container *ngIf="tag.exclude">
									<div class="excluded"><mat-icon matTooltip="This tag is excluded">visibility_off</mat-icon></div>
								</ng-container>
								<div class="remove-btn cursor-pointer" (click)="onRemoveTag(i, 'new')"><mat-icon>close</mat-icon></div>
							</div>
						</div>
					</div>

					<!-- NEWLY ASSIGNED TAGS ROW -->
					<div class="tags-row newly-assigned-tags d-flex">
						<h4>To Assign:</h4>

						<!-- NEWLY ASSIGNED TAGS LIST -->
						<div class="tags-container d-flex flex-row align-items-start flex-wrap">
							<div
								class="tag d-flex align-items-center"
								*ngFor="let tag of form.get('existing').value; let i = index"
								[style.backgroundColor]="tag.tagColor">
								<div class="name" matTooltip="{{ tag.description }}">{{ tag.name }}</div>
								<ng-container *ngIf="tag.exclude">
									<div class="excluded"><mat-icon matTooltip="This tag is excluded">visibility_off</mat-icon></div>
								</ng-container>
								<div class="remove-btn cursor-pointer" (click)="onRemoveTag(i, 'existing')"><mat-icon>close</mat-icon></div>
							</div>
						</div>
					</div>

					<!-- CURRENT TAGS ROW -->
					<div class="tags-row current-tags d-flex">
						<h4>Current:</h4>

						<!-- CURRENT TAGS TAGS LIST -->
						<div class="tags-container d-flex flex-row align-items-start flex-wrap">
							<div
								class="tag d-flex align-items-center"
								*ngFor="let tag of currentTags; let i = index"
								[style.backgroundColor]="tag.tagColor">
								<div class="name" matTooltip="{{ tag.description }}">{{ tag.name }}</div>
								<ng-container *ngIf="tag.exclude">
									<div class="excluded"><mat-icon matTooltip="This tag is excluded">visibility_off</mat-icon></div>
								</ng-container>
								<div class="remove-btn cursor-pointer" (click)="onRemoveTag(i, 'current', tag)">
									<mat-icon>close</mat-icon>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- SUBMIT BUTTON -->
				<div mat-dialog-actions>
					<button mat-button mat-raised-button class="submit theme-btn _primary" type="submit" [disabled]="cannotSubmitTags()">
						Submit
					</button>
				</div>
			</form>
		</div>
	</div>
</div>

<ng-template #selectOwner>
	<mat-form-field class="full-width">
		<mat-label>Select Owner</mat-label>
		<input matInput disabled />
	</mat-form-field>
</ng-template>
