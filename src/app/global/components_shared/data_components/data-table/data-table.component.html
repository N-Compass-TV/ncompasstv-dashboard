<div class="theme-table" *ngIf="!table_data.message; else no_records_found" [ngClass]="paging_details ? 'with-page' : ''">
	<table class="full-width" *ngIf="table_data.length > 0; else loading">
		<thead align="left" class="border-bottom">
			<tr>
				<th *ngIf="multiple_delete" class="text-right" class="p-3">
					<mat-checkbox class="example-margin" (change)="updateCheck()" [(ngModel)]="selectAll"></mat-checkbox>
				</th>
				<th *ngFor="let tc of table_columns" class="p-3" [ngClass]="tc.column && active_tab == tc.column ? 'tab-active': ''">
					{{ !tc.name ? tc : tc.name }} 
					<i *ngIf="tc.sortable" class="sort cursor-pointer ml-2 fas fa-angle-{{sort_order == 'desc' ? 'down' : 'up'}}" (click)="sortByColumnName(tc.column, sort_order == 'desc' ? 'asc' : 'desc')" data-toggle="tooltip" title="Sorted by {{sort_order == 'desc' ? 'Descending' : 'Ascending'}} Order"></i>
				</th>
				<!-- For activate toggle [[DEALER LICENSE TABLE]] -->
				<th *ngIf="ctrl_column" class="text-right" class="p-3">
					{{ ctrl_column_label || 'Action' }}
				</th>
				<!-- For preview column [[SINGLE ADVERTISER PAGE]] -->
				<th *ngIf="preview_column" class="text-right" class="p-3">
					{{ preview_column_label || 'Action' }}
				</th>
				<th *ngIf="license_delete || playlist_delete || advertiser_delete" class="text-right" class="p-3">
					{{ 'Action' }}
				</th>
			</tr>
		</thead>

		<tbody *ngIf="new_table">
			<tr *ngFor="let data of table_data; let j=index" >
				<td class="p-3" *ngFor="let d of data | objectKeys; let i = index" [hidden]="data[d].hidden && !data[d].key">
					<span *ngIf="data[d].hidden && data[d].key">
						<mat-checkbox class="example-margin" [checked]="(checkIfDisabled(data)) ? null : data.checked" (change)="OnCheckboxSelect(data[d].value, $event.checked, data[d])" [disabled]="checkIfDisabled(data)"></mat-checkbox>
					</span>
					<span *ngIf="!data[d].hidden">
						<span class="text-center" *ngIf="license_status_column && data[d].status">
							<i class="fas fa-circle mr-2" [ngClass]="(data.pi_status.value == 1) ? 'text-primary':'text-danger'" title="{{data.pi_status.value == 1 ? 'Online':'Offline'}}"></i>
						</span>		

						<ng-container *ngIf="!data[d].isImage; else isImage;">
							<a class="cursor-pointer table-row-url" *ngIf="data[d].link != null; else no_link" [routerLink]="[data[d].link]" [queryParams]="query_params">
								<ng-container>
									{{ data[d].value }}
								</ng-container>
							</a>
							
							<ng-template #no_link>
								<span [ngClass]="{'text-danger font-weight-bold' : data[d].offline_field, 'text-primary font-weight-bold': data[d].online_field }">

									<div *ngIf="data[d].label && data[d].label.trim().length > 1 && data[d].label.includes('Last Push') && !data[d].value.includes('--') else defaultvalue;">
										{{ data[d].value | date: 'MMM dd, y' }}<br>
										{{ data[d].value | date: 'hh:mm a' }}
									</div>

									<ng-template #defaultvalue>
										{{ data[d].value }}
									</ng-template>
								</span>
							</ng-template>
						</ng-container>

						<ng-template #isImage>
							<ng-container *ngIf="data[d].value; else noImage">
								<a [href]="data[d].value" target="_blank">
									<img [src]="data[d].value" alt="screenshot" style="width: 50px; margin-bottom: 5px;">
								</a>
								<br>
								<span>{{ data[d].value | screenshot }}</span>
							</ng-container>

							<ng-template #noImage>
								<span>--</span>
							</ng-template>
						</ng-template>
					</span>
					<div class="float-right" *ngIf="data[d].editable" mat-dialog-content (click)="editField(data[d], data[d].label, data[d].value)">
						<i class="clickable fa fa-pencil text-gray" title="Edit {{data[d].label}}"></i>
					</div>
				</td>		
				<td class="p-3 control-toggle text-center" *ngIf="ctrl_column">
					<mat-slide-toggle 
					*ngIf="ctrl_toggle"
					(change)="controlToggle(data.license_key.value, $event)"
					[checked]="data.is_activated.value == 1 ? 'checked' : 'false'">
					</mat-slide-toggle>
				</td>
				<td class="p-3 control-toggle" *ngIf="preview_column">
					<i class="fas fa-play cursor-pointer" (click)="mediaViewer_open(j)"></i>	
				</td>
				<td class="p-3 control-toggle md-text" *ngIf="feed_controls">
					<i class="fas fa-play cursor-pointer mx-2 text-primary" title="Preview" *ngIf="feed_preview" (click)="feedPreview_open(data.feed_url)"></i>
					<i class="fas fa-edit cursor-pointer mx-3 text-dark" title="Edit" *ngIf="feed_edit" (click)="editFeed(data)"></i>
					<i class="fas fa-trash cursor-pointer mx-2 text-danger" title="Delete" *ngIf="feed_delete" (click)="deleteFeed(data.id.value)"></i>
				</td>
				<td class="p-3 control-toggle" *ngIf="advertiser_delete">
					<i class="fas fa-trash cursor-pointer" title="Delete Advertiser" (click)="deleteAdvertiser(data.id.value)"></i>
				</td>
				<td class="p-3 control-toggle" *ngIf="screen_delete">
					<i class="fas fa-trash cursor-pointer" title="Delete Screen" (click)="deleteScreen(data.screen_id.value)"></i>
				</td>
				<td class="p-3 control-toggle" *ngIf="playlist_delete">
					<i class="fas fa-trash cursor-pointer mx-3 text-danger" title="Delete Playlist" (click)="deletePlaylist(data.playlist_id.value)"></i>
					<i *ngIf="!is_dealer" class="fas fa-file-excel" [ngClass]="data.allow_export.value ? 'text-primary cursor-pointer': 'text-gray cursor-void'"  title="{{data.allow_export.value ? 'Export contents to CSV' : 'Export not available, Playlist has no content.'}}" (click)="exportPlaylist({id: data.playlist_id.value, name: data.name.value})"></i>
				</td>
				<td class="p-3 control-toggle text-center" *ngIf="license_delete">
					<i class="fas fa-trash {{data.pi_status.value != 1  && !data.is_assigned.value ? 'text-danger cursor-pointer' : 'text-gray cursor-void'}}" data-toggle="tooltip" title="{{data.pi_status.value != 1  && !data.is_assigned.value ? 'Delete License' : 'Delete disabled, License is online / assigned'}}" (click)="deleteLicense(data.license_id.value)"></i>
				</td>
			</tr>
		</tbody>
	</table>
	
	<ng-template #loading>
		<div class="loading-wrapper">
			<app-spinner></app-spinner>
		</div>
	</ng-template>

	<div class="row" *ngIf="table_data.length > 0 && !paging_details">
		<div class="col-lg-12 text-center mt-4">
			<pagination-controls 
			(pageChange)="onPageChange($event)" 
			class="sm-text">
			</pagination-controls>
		</div>
	</div>

	<app-pagination-field
		[paging_data]="paging_details"
		(get_page)="getPage($event)">
	</app-pagination-field>
</div>

<ng-template #no_records_found>
	<app-error-message></app-error-message>
</ng-template>