<mat-card class="p-4 position-relative">
	<div class="title-section d-flex align-items-center mb-3">
		<div class="flex-even">
			<h3>Playlist Content</h3>
			<p class="xsm-text mb-0">
				Total Playlist Content: <strong>{{ playlist_contents.length}}</strong> / 
				Videos: <strong>{{ video_count || 0 }}</strong> / 
				Images: <strong>{{ image_count || 0 }}</strong> / 
				Feed: <strong>{{ feed_count || 0 }}</strong>
			</p>
		</div>
		<div>
			<button mat-button mat-raised-button class="theme-btn flex-even mx-1" (click)="openPlaylistDemo()">
				Playlist Demo
				<span class="fas fa-play ml-2 sm-text"></span>
			</button>

			<button mat-button mat-raised-button class="theme-btn flex-even mx-1" (click)="openPlaylistMedia()" [disabled]="is_view_only">
				Add Playlist Content
				<span class="fas fa-photo-video ml-2 sm-text"></span>
			</button>

			<!-- SWAP CONTENT BUTTON -->
			<button mat-button mat-raised-button class="theme-btn flex-even mx-1" (click)="openPlaylistMedia('swap')" [disabled]="is_view_only || !is_marking || selected_contents.length !== 1">
				Swap Content
				<span class="fas fa-exchange-alt ml-2 sm-text"></span>
			</button>

			<button mat-button mat-raised-button class="theme-btn flex-even mx-1" [disabled]="playlist_unchanged" (click)="saveOrderChanges()" [disabled]="is_view_only">
				Save Changes
				<span class="fas fa-save ml-2 sm-text"></span>
			</button>
		</div>
	</div>
	<hr>
	<div class="d-flex mb-4 align-items-center">
		<div class="flex-even">
			<div class="d-flex align-items-center">
				<div>
					<mat-slide-toggle
						[(ngModel)]="bulk_toggle"
						(change)="isMarking($event)"
						[disabled]="is_view_only">
					</mat-slide-toggle>
				</div>
				<div class="ml-2 flex-even">
					<h5 class="mb-0">
						Mark Contents
					</h5>
					<p class="xsm-text mb-0">Dragging will be disabled during bulk action marking.</p>
				</div>
			</div>
		</div>
		<div class="text-right">
			<!-- FILTER DROPDOWN -->
			<mat-form-field class="content-filter-dropdown">
				<mat-label>Filter By Status</mat-label>
				<mat-select (selectionChange)="onSelectContentFilter($event.value)" [(value)]="currentContentFilter" [disabled]="is_marking">
					<mat-option *ngFor="let filter of contentFilterOptions" [value]="filter.key">
						{{ filter.label }}
					</mat-option>
				</mat-select>
			</mat-form-field>

			<!-- SET SCHEDULE BUTTON -->
			<button mat-button mat-raised-button class="theme-btn flex-even mx-1" 
				(click)="onSetSchedule()"
				[ngClass]="{ 'hidden' : !can_set_schedule }"
				[disabled]="is_view_only">
				Set Schedule
				<span class="fas fa-calendar ml-2 sm-text"></span>
			</button>

			<!-- LIST/GRID VIEW BUTTON -->
			<button mat-button mat-raised-button class="theme-btn flex-even mx-1" (click)="onViewContentList()">
				<span *ngIf="!list_view_mode; else grid">
                    List View
                    <span class="fas fa-list ml-2 sm-text"></span>
                </span>
                <ng-template #grid>
                    <span>
                        Grid View
                        <span class="fas fa-th ml-2 sm-text"></span>
                    </span>
                </ng-template>
				
			</button>

			<!-- VIEW SCHEDULES BUTTON -->
			<button mat-button mat-raised-button class="theme-btn flex-even mx-1" (click)="onViewSchedule()">
				Schedules
				<span class="fas fa-calendar ml-2 sm-text"></span>
			</button>

			<button mat-button mat-raised-button class="theme-btn flex-even mx-1" (click)="selectAllContents()" [disabled]="!is_marking">
				Select All
				<span class="fas fa-check ml-2 sm-text"></span>
			</button>

			<button mat-button mat-raised-button class="theme-btn flex-even mx-1" 
				(click)="bulkModify()" 
				[disabled]="selected_contents.length == 0 || is_view_only">
				Modify
				<span class="fas fa-cog ml-2 sm-text"></span>
			</button>

			<button mat-button mat-raised-button class="theme-btn flex-even mx-1 _danger" 
				(click)="bulkContentRemove()" 
				[disabled]="selected_contents.length == 0 || is_view_only">
				Remove
				<span class="fas fa-trash ml-2 sm-text"></span>
			</button>
		</div>
	</div>

	<div class="search-playlist-content">
		<mat-form-field class="w-100" appearance="fill">
			<mat-label><span class="fas fa-search mr-2"font-weight-bold></span> Search Playlist Content</mat-label>
			<input type="text"
			placeholder="Enter Content Name"
			aria-label="Number"
			matInput
			[formControl]="search_control">
		</mat-form-field>
	</div>

	<div class="playlist-content-panel" [ngClass]="is_marking ? 'd-none' : null">
		<div class="row no-gutters" #draggables id="draggables">
			<div id="{{ 'drg_' + content.playlistContentId }}" 
				*ngFor="let content of playlist_contents; let i = index;"
				[class.undraggable]="content.isProtected && is_dealer"
				[attr.data-id]="content.playlistContentId"
				[ngClass]="{'marked' : selected_contents.includes(content.playlistContentId), 'col-lg-4': list_view_mode, 'col-lg-1': !list_view_mode}">
				
				<app-playlist-content
					[playlist_host_license]="playlist_host_license"
					[array_index]="playlist_content_backup.indexOf(content) + 1 || i + 1"
					[dealer]="content.dealerId"
					[content]="content"
					[is_marking]="is_marking"
					[schedule_status]="content.scheduleStatus"
					[page]="page"
					[total_contents]="playlist_contents.length"
					[is_list]="list_view_mode"
					[is_view_only]="is_view_only"
					[is_admin]="is_admin"
					[is_dealer]="is_dealer"
					(options_saved)="optionsSaved($event)"
					(reset_playlist_content)="reloadPlaylist()"
					(remove_playlist_content)="removePlaylistContent($event)"
					(log_content_history)="logRemovedContent($event)"
                    [playlist_contents]="playlist_contents">
				</app-playlist-content>

			</div>
		</div>
	</div>

	<div class="playlist-content-panel" [ngClass]="is_marking ? null : 'd-none'" *ngIf="!is_loading; else loader">
		<div class="row no-gutters">
			<div id="{{ 'drg_' + content.playlistContentId }}" 
				*ngFor="let content of playlist_contents; let i = index"
				[attr.data-id]="content.playlistContentId"
				[class.undraggable]="content.isProtected && is_dealer"
				[class.future-schedule]="content.scheduleStatus === 'future'"
				[class.inactive-schedule]="content.scheduleStatus === 'inactive'"
				[ngClass]="{'marked' : selected_contents.includes(content.playlistContentId), 'col-lg-1' : !list_view_mode, 'col-lg-4': list_view_mode}">
				
				<app-playlist-content
					[playlist_host_license]="playlist_host_license"
					[array_index]="playlist_content_backup.indexOf(content) + 1 || i + 1"
					[content]="content"
					[dealer]="content.dealerId"
					[is_marking]="is_marking"
					[schedule_status]="content.scheduleStatus"
					[page]="page"
					[total_contents]="playlist_contents.length"
					[is_list]="list_view_mode"
					[is_view_only]="is_view_only"
					[is_admin]="is_admin"
					[is_dealer]="is_dealer"
					(options_saved)="optionsSaved($event)"
					(click)="selectedContent(content.playlistContentId, content.contentId, content.frequency, content.classification)"
					(reset_playlist_content)="reloadPlaylist()"
					(remove_playlist_content)="removePlaylistContent($event)">
				</app-playlist-content>

			</div>
		</div>
	</div>

	<div class="loading-overlay d-flex align-items-center" *ngIf="playlist_saving">
		<div class="flex-even text-center">
			<app-spinner></app-spinner>
			<h5 class="text-primary mt-4">Saving Playlist Changes, Please Wait . . .</h5>
		</div>
	</div>

	<div class="content-selected-count p-3 text-center bg-primary" *ngIf="selected_content_count > 0" [ngClass]="selected_content_count > 0 ? 'show' : null">
		<h5 class="font-weight-bold mb-0 sm-text">{{ selected_content_count }} File<span *ngIf="selected_content_count > 1">s</span> Selected</h5>
	</div>
</mat-card>

<ng-template #loader>
	<div class="loading-overlay d-flex justify-content-center">
		<app-spinner></app-spinner>
	</div>
</ng-template>